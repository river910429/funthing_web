<!DOCTYPE html>
<html>
<head>
        <link href="{{ url_for('static', filename='css/template_selection.css')}}" rel="stylesheet", type="text/css">
        
        <!-- [æ–°å¢] å¼•å…¥ ta_home.css ä»¥å–å¾—ä¸‹æ‹‰é¸å–®æ¨£å¼ -->
        <link href="{{ url_for('static', filename='css/ta_home.css')}}" rel="stylesheet" type="text/css">
        
        <!-- Core theme CSS (includes Bootstrap 5.0.2) -->
        <link rel="stylesheet" type="text/css" href="/static/css/bootstrap-5.0.2.min.css">
        <script type="text/javascript" src="/static/js/jquery-3.6.0.min.js"></script>
        <script type="text/javascript" src="{{ url_for('static', filename='js/ta_template.js')}}"></script>
        <style>
            /* èª¿æ•´é¸å–®ä½ç½®ï¼Œé¿å…é‡ç–Š */
            /* ç­ç´šé¸å–®åœ¨ä¸Šæ–¹ */
            #class_select {
                position: absolute;
                width: 30%;
                top: 40%; 
                left: 35%;
                z-index: 400;
                font-size: 1.2rem;
                padding: 10px;
                border: 3px solid #f4da63;
                border-radius: 10px;
            }
            /* èª²ç¨‹é¸å–®åœ¨ä¸‹æ–¹ */
            #lesson {
                position: absolute;
                width: 30%;
                top: 55%; 
                left: 35%;
                z-index: 400;
                font-size: 1.2rem;
                padding: 10px;
                border: 3px solid #f4da63;
                border-radius: 10px;
            }
            /* ç¢ºèªèˆ‡å–æ¶ˆæŒ‰éˆ•ä½ç½®å¾®èª¿ */
            #confirm_btn {
                position: absolute;
                width: 12%;
                top: 70%;
                left: 35%;
                cursor: pointer;
                z-index: 400;
            }
            #cancel_btn {
                position: absolute;
                width: 12%;
                top: 70%;
                left: 53%;
                cursor: pointer;
                z-index: 400;
            }
        </style>
</head>
<body>
        <img id="background_img" src="{{ url_for('static', filename='Font/1x/ALL_BG_GRID.png')}}">
        <div class="parent">
            <img id="back_btn" onclick="back()" src="{{ url_for('static', filename='4GAME_ALL/ALL/1x/ALL_ARROW_BACK.png')}}">
            <img id="home_btn" onclick="home()" src="{{ url_for('static', filename='4GAME_ALL/ALL/1x/ALL_HOME.png')}}">
            
            <!-- [ä¿®æ”¹] ä¸‹æ‹‰é¸å–®çµæ§‹ (çµ±ä¸€é¢¨æ ¼) -->
            <div class="btn-group" id="profile">
                <button type="button" id="dropdownMenuReference"
                        data-bs-toggle="dropdown" aria-expanded="false" data-bs-reference="parent">
                    <img src="/static/4GAME_ALL/ALL/1x/ALL_ACCOUNT.png">
                </button>
                <ul class="dropdown-menu" aria-labelledby="dropdownMenuReference">
                    
                    <!-- ç­ç´šç®¡ç†æŒ‰éˆ• (é»ƒè‰²) -->
                    <li>
                        <button class="menu-btn-custom" onclick="class_entrance()">
                            <span class="btn-icon">ğŸ«</span>
                            <span>ç­ç´šç®¡ç†</span>
                        </button>
                    </li>
                    
                    <!-- ç™»å‡ºæŒ‰éˆ• (ç°è‰²æ–‡å­—ç‰ˆ) -->
                    <li>
                        <button class="menu-btn-custom" onclick="exit()" 
                                style="background: linear-gradient(180deg, #F5F5F5 0%, #E0E0E0 100%); 
                                       border-color: #B0B0B0; 
                                       color: #555; 
                                       box-shadow: 0 2px 0 #999;">
                            <span class="btn-icon">â†ª</span>
                            <span>ç™»å‡ºéŠæˆ²</span>
                        </button>
                    </li>
                </ul>
            </div>

            <!-- [æ³¨æ„] åˆ‡æ°´æœéŠæˆ²çš„å°è¦½åˆ— -->
            <img id="nav_bar" src="{{ url_for('static', filename='Font/1x/ALL_NAVIGATION_BAR_CUT_FRUIT.png')}}">
            
            <!-- ç­ç´šé¸æ“‡ä¸‹æ‹‰é¸å–® -->
            <select id="class_select" class="form-select" aria-label="Select Class">
                <option selected disabled>è«‹é¸æ“‡ç­ç´š</option>
            </select>

            <!-- èª²ç¨‹é¸æ“‡ä¸‹æ‹‰é¸å–® -->
            <select id="lesson" class="form-select" aria-label="Default select example">
                <option selected disabled>è«‹é¸æ“‡å–®å…ƒ</option>
            </select>

            <img id="confirm_btn" src="{{ url_for('static', filename='4GAME_ALL/ALL/1x/ALL_CONFIRM_B.png')}}">
            <img id="cancel_btn" onclick="back()" src="{{ url_for('static', filename='4GAME_ALL/ALL/1x/ALL_RETURN_B.png')}}">                        
        </div>

    <div class="modal fade" id="LogoutModal" data-bs-backdrop="static" 
        data-bs-keyboard="false" tabindex="-1" 
        aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-body">
                    <div class="container-fluid">
                        <div class="d-flex flex-column align-items-center">
                            <img src="/static/Font/1x/ALL_IF_LOGOUT_B.png" style="width: 100%">
                            <!-- <div>title</div> -->
                            <div class="d-flex justify-content-between w-100">
                                <div class="alertbtn alertbtn-succ" data-bs-dismiss="modal">
                                    å–æ¶ˆ
                                </div>
                                <div class="alertbtn alertbtn-warn" id="mlogout">
                                    ç™»å‡º
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="SetSuccessModal" data-bs-backdrop="static" 
        data-bs-keyboard="false" tabindex="-1" 
        aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-body">
                    <div class="container-fluid">
                        <div class="d-flex flex-column align-items-center">
                            <img src="/static/4GAME_ALL/ALL/1x/ALL_SET SUCCESSFULLY_B.png" style="width: 100%">
                            <!-- <div>title</div> -->
                            <div class="d-flex justify-content-center w-100">
                                <div class="alertbtn alertbtn-normal" data-bs-dismiss="modal">
                                    å®Œæˆ
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- my alert -->
    <link rel="stylesheet" type="text/css" href="/static/css/myalert.css">
    <!-- Bootstrap core JS 5.0.2 -->
    <script src="/static/js/bootstrap-5.0.2.min.js"></script>
</body>
</html>

<script>
    $(document).ready(function(){
        $.ajax({
            method: "POST",
            url: "/template/course/search",
            contentType: 'application/json',
            data: JSON.stringify({
                "game_name": "game3" // [æ³¨æ„] åˆ‡æ°´æœæ˜¯ game3
            }),
            dataType: "json",
        })
        .done(function(result) {
            console.log(result);
            if (result["status"] == "success") {
                // 1. å¡«å…¥èª²ç¨‹
                var courses = result["results"];
                if (courses && courses.length > 0) {
                    for (var i = 0; i < courses.length; i++) {
                        var myopt_html = `<option value="${courses[i]["id"]}">${courses[i]["name"]}</option>`;
                        $("#lesson").append(myopt_html);
                    }
                } else {
                    $("#lesson").append(`<option disabled>ç„¡èª²ç¨‹è³‡æ–™</option>`);
                }

                // 2. å¡«å…¥ç­ç´š
                var classes = result["classes"];
                if (classes && classes.length > 0) {
                    for (var i = 0; i < classes.length; i++) {
                        var cls_html = `<option value="${classes[i]["id"]}">${classes[i]["name"]}</option>`;
                        $("#class_select").append(cls_html);
                    }
                } else {
                    $("#class_select").append(`<option disabled>ç„¡ç­ç´šè³‡æ–™ï¼Œè«‹å…ˆå»ºç«‹ç­ç´š</option>`);
                }
            } else {
                alert("è¼‰å…¥å¤±æ•—: " + (result["message"] || "æœªçŸ¥éŒ¯èª¤"));
            }
        })
        .fail(function(xhr, status, error) {
            console.error("Error Details:", xhr.responseText);
            alert("ç³»çµ±éŒ¯èª¤ï¼šç„¡æ³•è¼‰å…¥è³‡æ–™ã€‚\nè©³ç´°è¨Šæ¯: " + status + " " + error);
        });
    });

    $("#confirm_btn").click(function() {
        var course_id = $( "#lesson option:selected" ).val();
        var class_id = $( "#class_select option:selected" ).val();

        // æª¢æŸ¥æ˜¯å¦å·²é¸æ“‡
        if (course_id === "è«‹é¸æ“‡å–®å…ƒ" || !course_id || course_id === "ç„¡èª²ç¨‹è³‡æ–™") {
            alert("è«‹é¸æ“‡ä¸€å€‹å–®å…ƒèª²ç¨‹");
            return;
        }
        if (class_id === "è«‹é¸æ“‡ç­ç´š" || !class_id || class_id === "ç„¡ç­ç´šè³‡æ–™ï¼Œè«‹å…ˆå»ºç«‹ç­ç´š") {
            alert("è«‹é¸æ“‡ä¸€å€‹ç­ç´š");
            return;
        }

        console.log("Updating: Class=" + class_id + ", Course=" + course_id);

        $.ajax({
            method: "POST",
            url: "/template/course/update",
            contentType: 'application/json',
            data: JSON.stringify({
                "game_name": "game3", // [æ³¨æ„] åˆ‡æ°´æœæ˜¯ game3
                "course_id": course_id,
                "class_id": class_id
            }),
            dataType: "json",
        })
        .done(function(result) {
            console.log(result);
            if (result["status"] == "success") {
                var SetSuccessModal = new bootstrap.Modal($('#SetSuccessModal'));
                if (! $('#SetSuccessModal').hasClass('show')) SetSuccessModal.show();
            } else {
                alert("è¨­å®šå¤±æ•—ï¼š" + (result["message"] || "æœªçŸ¥éŒ¯èª¤"));
            }
        })
        .fail(function(xhr, status, error) {
            console.error("Update Error:", xhr.responseText);
            alert("è¨­å®šå¤±æ•—ï¼Œé€£ç·šéŒ¯èª¤ã€‚\n" + error);
        });
    });

    function back() {
        window.location.href = "{{ url_for('teacher.ta_template') }}";
    }
    
    function home() {
        window.location.href = "{{ url_for('teacher.ta_home') }}";
    }

    function exit() {
            var LogoutModal = new bootstrap.Modal($('#LogoutModal'));
            if (! $('#LogoutModal').hasClass('show')) LogoutModal.show();
    }
    $("#mlogout").click(function() {
        document.location.href="/branch";
    });

    // [æ–°å¢] è·³è½‰åˆ°ç­ç´šç®¡ç†
    function class_entrance() {
        window.location.href = "{{ url_for('teacher.ta_class_management') }}";
    }
</script>
</html>