<!DOCTYPE html>
<html>
    <head>
        <link href="{{ url_for('static', filename='css/login_page_stu.css')}}" rel="stylesheet", type="text/css">
        <script type="text/javascript" src="{{ url_for('static', filename='js/entrance.js')}}"></script>
        <style>
            /* 下拉選單樣式 (學生版) */
            .dropdown-menu {
                position: absolute;
                z-index: 1000;
                min-width: 180px !important;
                width: auto !important;
                padding: 12px !important;
                margin: 0 !important;
                background-color: rgba(255, 255, 255, 0.95);
                border: 1px solid #ccc;
                border-radius: 10px;
                box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                top: 100% !important;
                margin-top: 10px !important;
                right: 0 !important;
                left: auto !important;
                transform: none !important;
                display: none; 
                flex-direction: column;
                align-items: center;
                gap: 8px;
            }
            .dropdown-menu.show { display: flex; }
            .dropdown-menu li { list-style: none; width: 100%; margin: 0; padding: 0; display: flex; justify-content: center; }
    
            /* 個人裝備按鈕 (黃色) */
            .menu-btn-custom {
                display: flex; flex-direction: row; align-items: center; justify-content: center;
                width: 100%; height: 50px;
                background: linear-gradient(to bottom, #ffffff 0%, #f4da63 100%);
                border: 2px solid #d4b755; border-radius: 8px;
                color: #333; font-size: 18px; font-weight: bold; letter-spacing: 1px;
                cursor: pointer; text-decoration: none; white-space: nowrap;
                box-shadow: 0 2px 4px rgba(0,0,0,0.1); transition: all 0.2s; padding: 0 10px;
            }
            .menu-btn-custom:hover { background: linear-gradient(to bottom, #fff 0%, #ffe066 100%); transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
            .btn-icon { margin-right: 8px; font-size: 20px; }
    
            /* 登出按鈕 (灰色) */
            #dropdown-leave {
                display: flex; align-items: center; justify-content: center;
                width: 100%; height: 50px;
                background: linear-gradient(180deg, #F5F5F5 0%, #E0E0E0 100%);
                border: 2px solid #B0B0B0; border-radius: 8px;
                color: #555; font-size: 18px; font-weight: bold; letter-spacing: 1px;
                cursor: pointer; padding: 0 15px;
                box-shadow: 0 2px 4px rgba(0,0,0,0.1); transition: all 0.2s;
                background-image: none;
            }
            /* #dropdown-leave::before { content: "↪"; margin-right: 8px; font-size: 20px; } */
            #dropdown-leave::after { content: "登出遊戲"; }
            #dropdown-leave:hover { background: linear-gradient(180deg, #FFFFFF 0%, #EEEEEE 100%); transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.15); color: #333; }
            #dropdown-leave:active { transform: translateY(0); box-shadow: none; }
        </style>

    </head>

    <body>
        <div class="parent">
            <img id="back_img" src="{{ url_for('static', filename='Font/1x/ALL_NAV_BAR_BACK.png')}}">

            <img id="background_img" src="{{ url_for('static', filename='Font/1x/ALL_LOG_IN_STUDENT.png')}}">
            
            <div id = "login_div">
                <div id="login_form">
                    <!-- [修改] 移除班級代碼輸入框 -->

                    <!-- 帳號 -->
                    <input type="text" id="account_box" name="account" placeholder="帳號 (Email)"/><br><br>
                    
                    <!-- 密碼 -->
                    <input type="password" id="pwd_box" name="pwd" placeholder="密碼"/><br><br>
                    
                    <p id="login_msg">&nbsp</p>
                    <input type="image" id="submit_btn" src="{{ url_for('static', filename='4GAME_ALL/ALL/1x/ALL_CONFIRM_B.png')}}" alt="Submit Form" />
                
                    <p style="text-align:center; margin-top:10px;">
                        <a href="/register/stu"
                           style="color:#0055ff; text-decoration:none; font-size:16px; font-weight: bold;">
                          沒有帳號？點此註冊
                        </a>
                    </p>
                </div>
            </div>
        </div>
    </body>

    <script src="/static/js/jquery-3.6.0.min.js"></script>
    <script>
        $("#back_img").click(function() {
            window.location.href = "/branch";
        });

        $(document).on('keypress',function(e) {
            if(e.which == 13) v();
        });
        $("#submit_btn").click(function() {
            v();
        });

        function v(){
            // [修改] 移除代碼檢查
            if(!$("#account_box").val() || !$("#pwd_box").val()) {
                $("#login_msg").text("*請完整填寫帳號與密碼*");
                return;
            }

            $.ajax({
                method: "POST",
                url: "/verifying",
                contentType: 'application/json',
                data: JSON.stringify({
                    // [修改] 不再傳送 code
                    account: $("#account_box").val(),
                    pwd: $("#pwd_box").val()
                }),
                dataType: "json",
            })
            .done(function(result) {
                console.log(result);
                if (result["status"] == "success")
                    window.location.href = result["url"]
                else
                    $("#login_msg").text("*" + (result["message"] || "帳號或密碼錯誤"));
            })
            .fail(function() {
                $("#login_msg").text("*連線失敗，請稍後再試*");
            });
        }
    </script>
</html>